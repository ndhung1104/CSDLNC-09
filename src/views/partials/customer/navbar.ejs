<% const bp = typeof basePath !== 'undefined' ? basePath : '/customer'; %>
<% const showMgmt = typeof showManagementLink !== 'undefined' ? showManagementLink : true; %>
<% const rawCustomerUser = (typeof customerUser !== 'undefined') ? customerUser : null; %>
<% const rawUser = (typeof user !== 'undefined') ? user : null; %>
<% const activeUser = rawCustomerUser || rawUser || null; %>
<nav class="navbar navbar-expand-lg navbar-light customer-navbar sticky-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="<%= bp %>/dashboard">
      <i class="bi bi-heart-pulse-fill text-primary me-2" style="font-size: 1.5rem;"></i>
      <span class="fw-bold">PETCAREX</span>
    </a>
    <% if (showMgmt) { %>
      <a class="btn btn-outline-secondary btn-sm ms-2" href="/management/customers">
        <i class="bi bi-speedometer2 me-1"></i>
        Management
      </a>
    <% } %>
    <% if (activeUser) { %>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#customerNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="customerNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="<%= bp %>/dashboard">
              <i class="bi bi-house-door me-1"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="<%= bp %>/appointments">
              <i class="bi bi-calendar-check me-1"></i>
              My Appointments
            </a>
          </li>
          <% if (bp.includes('/guest/customer')) { %>
            <li class="nav-item">
              <a class="nav-link" href="<%= bp %>/products">
                <i class="bi bi-bag me-1"></i>
                Products
              </a>
            </li>
          <% } %>
          <li class="nav-item">
            <a class="nav-link" href="<%= bp %>/pets">
              <i class="bi bi-heart me-1"></i>
              My Pets
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="<%= bp %>/receipts">
              <i class="bi bi-receipt me-1"></i>
              Receipts
            </a>
          </li>
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle d-flex align-items-center"
              href="#"
              id="userDropdown"
              role="button"
              data-bs-toggle="dropdown"
            >
              <span class="avatar-circle me-2"><%= activeUser.initials || (activeUser.name ? activeUser.name.split(' ').map(p => p[0]).join('').slice(0,2).toUpperCase() : 'CU') %></span>
              <%= activeUser.name %>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a class="dropdown-item" href="<%= bp %>/profile">
                  <i class="bi bi-person me-2"></i>
                  My Profile
                </a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item text-danger" href="<%= bp %>/logout">
                  <i class="bi bi-box-arrow-right me-2"></i>
                  Logout
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    <% } else { %>
      <div class="d-flex">
        <a href="<%= bp %>/login" class="btn btn-outline-primary me-2">Login</a>
        <a href="<%= bp %>/register" class="btn btn-primary">Register</a>
      </div>
    <% } %>
  </div>
</nav>
